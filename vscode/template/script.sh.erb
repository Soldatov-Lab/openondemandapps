#!/usr/bin/env bash

# Benchmark info
echo "TIMING - Starting main script at: $(date)"

# Load modules
<%- if !context.modules.blank? -%>
module load <%= context.modules %>
<%- end -%>

# Set PFILE
PFILE="${PWD}/password.txt"

# Start VS Code Server
echo "TIMING - Starting vscode at: $(date)"

set -x
exec "<%= context.vscode_binary %>" serve-web \
  --host="0.0.0.0" \
  --port="${port}" \
  --connection-token-file="${PFILE}" \
  --accept-server-license-terms \
  --server-base-path="/node/${host}/${port}/" \
  --user-data-dir="${PWD}/config" \
  --extensions-dir="${HOME}/.vscode-server/extensions"
